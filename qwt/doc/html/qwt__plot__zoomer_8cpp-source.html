<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Qwt User&apos;s Guide: qwt_plot_zoomer.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>qwt_plot_zoomer.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode: C++ ; c-file-style: "stroustrup" -*- *****************************</span>
<a name="l00002"></a>00002 <span class="comment"> * Qwt Widget Library</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 1997   Josef Wilgen</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2002   Uwe Rathmann</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00007"></a>00007 <span class="comment"> * modify it under the terms of the Qwt License, Version 1.0</span>
<a name="l00008"></a>00008 <span class="comment"> *****************************************************************************/</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="comment">// vim: expandtab</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include "qwt_plot.h"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "qwt_plot_canvas.h"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "qwt_plot_zoomer.h"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "qwt_scale_div.h"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#if QT_VERSION &lt; 0x040000</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="keyword">typedef</span> QValueStack&lt;QwtDoubleRect&gt; QwtZoomStack;
<a name="l00019"></a>00019 <span class="preprocessor">#else</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="keyword">typedef</span> QStack&lt;QwtDoubleRect&gt; QwtZoomStack;
<a name="l00021"></a>00021 <span class="preprocessor">#endif</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="keyword">class </span>QwtPlotZoomer::PrivateData
<a name="l00024"></a>00024 {
<a name="l00025"></a>00025 <span class="keyword">public</span>:
<a name="l00026"></a>00026     uint <a class="code" href="class_qwt_plot_zoomer.html#a12">zoomRectIndex</a>;
<a name="l00027"></a>00027     QwtZoomStack <a class="code" href="class_qwt_plot_zoomer.html#a11">zoomStack</a>;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029     <span class="keywordtype">int</span> <a class="code" href="class_qwt_plot_zoomer.html#a10">maxStackDepth</a>;
<a name="l00030"></a>00030 };
<a name="l00031"></a>00031 
<a name="l00051"></a><a class="code" href="class_qwt_plot_zoomer.html#a0">00051</a> <a class="code" href="class_qwt_plot_zoomer.html#a0">QwtPlotZoomer::QwtPlotZoomer</a>(<a class="code" href="class_qwt_plot_canvas.html">QwtPlotCanvas</a> *<a class="code" href="class_qwt_plot_picker.html#a8">canvas</a>, <span class="keywordtype">bool</span> doReplot):
<a name="l00052"></a>00052     <a class="code" href="class_qwt_plot_picker.html">QwtPlotPicker</a>(canvas)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054     <span class="keywordflow">if</span> ( canvas )
<a name="l00055"></a>00055         init(RectSelection &amp; ClickSelection, ActiveOnly, doReplot);
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 
<a name="l00075"></a><a class="code" href="class_qwt_plot_zoomer.html#a1">00075</a> <a class="code" href="class_qwt_plot_zoomer.html#a0">QwtPlotZoomer::QwtPlotZoomer</a>(<span class="keywordtype">int</span> xAxis, <span class="keywordtype">int</span> yAxis,
<a name="l00076"></a>00076         <a class="code" href="class_qwt_plot_canvas.html">QwtPlotCanvas</a> *canvas, <span class="keywordtype">bool</span> doReplot):
<a name="l00077"></a>00077     <a class="code" href="class_qwt_plot_picker.html">QwtPlotPicker</a>(xAxis, yAxis, canvas)
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079     <span class="keywordflow">if</span> ( canvas )
<a name="l00080"></a>00080         init(RectSelection &amp; ClickSelection, ActiveOnly, doReplot);
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00103"></a><a class="code" href="class_qwt_plot_zoomer.html#a2">00103</a> <a class="code" href="class_qwt_plot_zoomer.html#a0">QwtPlotZoomer::QwtPlotZoomer</a>(<span class="keywordtype">int</span> xAxis, <span class="keywordtype">int</span> yAxis, <span class="keywordtype">int</span> selectionFlags,
<a name="l00104"></a>00104         DisplayMode trackerMode, <a class="code" href="class_qwt_plot_canvas.html">QwtPlotCanvas</a> *canvas, <span class="keywordtype">bool</span> doReplot):
<a name="l00105"></a>00105     <a class="code" href="class_qwt_plot_picker.html">QwtPlotPicker</a>(xAxis, yAxis, canvas)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107     <span class="keywordflow">if</span> ( canvas )
<a name="l00108"></a>00108         init(selectionFlags, trackerMode, doReplot);
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00112"></a>00112 <span class="keywordtype">void</span> QwtPlotZoomer::init(<span class="keywordtype">int</span> selectionFlags, 
<a name="l00113"></a>00113     DisplayMode trackerMode, <span class="keywordtype">bool</span> doReplot)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115     d_data = <span class="keyword">new</span> PrivateData;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     d_data-&gt;maxStackDepth = -1;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <a class="code" href="class_qwt_plot_zoomer.html#a13">setSelectionFlags</a>(selectionFlags);
<a name="l00120"></a>00120     <a class="code" href="class_qwt_picker.html#a7">setTrackerMode</a>(trackerMode);
<a name="l00121"></a>00121     <a class="code" href="class_qwt_picker.html#a5">setRubberBand</a>(RectRubberBand);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordflow">if</span> ( doReplot &amp;&amp; <a class="code" href="class_qwt_plot_picker.html#a6">plot</a>() )
<a name="l00124"></a>00124         <a class="code" href="class_qwt_plot_picker.html#a6">plot</a>()-&gt;<a class="code" href="class_qwt_plot.html#i1">replot</a>();
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <a class="code" href="class_qwt_plot_zoomer.html#a4">setZoomBase</a>(<a class="code" href="class_qwt_plot_picker.html#b0">scaleRect</a>());
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a><a class="code" href="class_qwt_plot_zoomer.html#a3">00129</a> <a class="code" href="class_qwt_plot_zoomer.html#a3">QwtPlotZoomer::~QwtPlotZoomer</a>()
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131     <span class="keyword">delete</span> d_data;
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 
<a name="l00145"></a><a class="code" href="class_qwt_plot_zoomer.html#a9">00145</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#a9">QwtPlotZoomer::setMaxStackDepth</a>(<span class="keywordtype">int</span> depth)
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147     d_data-&gt;maxStackDepth = depth;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="keywordflow">if</span> ( depth &gt;= 0 )
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151         <span class="comment">// unzoom if the current depth is below d_data-&gt;maxStackDepth</span>
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <span class="keyword">const</span> <span class="keywordtype">int</span> zoomOut = 
<a name="l00154"></a>00154             int(d_data-&gt;zoomStack.count()) - 1 - depth; <span class="comment">// -1 for the zoom base</span>
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         <span class="keywordflow">if</span> ( zoomOut &gt; 0 )
<a name="l00157"></a>00157         {
<a name="l00158"></a>00158             <a class="code" href="class_qwt_plot_zoomer.html#i2">zoom</a>(-zoomOut);
<a name="l00159"></a>00159             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = <span class="keywordtype">int</span>(d_data-&gt;zoomStack.count()) - 1; 
<a name="l00160"></a>00160                 i &gt; int(d_data-&gt;zoomRectIndex); i-- )
<a name="l00161"></a>00161             {
<a name="l00162"></a>00162                 (void)d_data-&gt;zoomStack.pop(); <span class="comment">// remove trailing rects</span>
<a name="l00163"></a>00163             }
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165     }
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00172"></a><a class="code" href="class_qwt_plot_zoomer.html#a10">00172</a> <span class="keywordtype">int</span> <a class="code" href="class_qwt_plot_zoomer.html#a10">QwtPlotZoomer::maxStackDepth</a>()<span class="keyword"> const</span>
<a name="l00173"></a>00173 <span class="keyword"></span>{
<a name="l00174"></a>00174     <span class="keywordflow">return</span> d_data-&gt;maxStackDepth;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00181"></a><a class="code" href="class_qwt_plot_zoomer.html#a11">00181</a> <span class="keyword">const</span> QwtZoomStack &amp;<a class="code" href="class_qwt_plot_zoomer.html#a11">QwtPlotZoomer::zoomStack</a>()<span class="keyword"> const</span>
<a name="l00182"></a>00182 <span class="keyword"></span>{
<a name="l00183"></a>00183     <span class="keywordflow">return</span> d_data-&gt;zoomStack;
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00190"></a><a class="code" href="class_qwt_plot_zoomer.html#a6">00190</a> QwtDoubleRect <a class="code" href="class_qwt_plot_zoomer.html#a6">QwtPlotZoomer::zoomBase</a>()<span class="keyword"> const</span>
<a name="l00191"></a>00191 <span class="keyword"></span>{
<a name="l00192"></a>00192     <span class="keywordflow">return</span> d_data-&gt;zoomStack[0];
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00208"></a><a class="code" href="class_qwt_plot_zoomer.html#a4">00208</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#a4">QwtPlotZoomer::setZoomBase</a>()
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210     <span class="keyword">const</span> <a class="code" href="class_qwt_plot.html">QwtPlot</a> *plt = <a class="code" href="class_qwt_plot_picker.html#a6">plot</a>();
<a name="l00211"></a>00211     <span class="keywordflow">if</span> ( !plt )
<a name="l00212"></a>00212         <span class="keywordflow">return</span>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     d_data-&gt;zoomStack.clear();
<a name="l00215"></a>00215     d_data-&gt;zoomStack.push(<a class="code" href="class_qwt_plot_picker.html#b0">scaleRect</a>());
<a name="l00216"></a>00216     d_data-&gt;zoomRectIndex = 0;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <a class="code" href="class_qwt_plot_zoomer.html#b0">rescale</a>();
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00231"></a><a class="code" href="class_qwt_plot_zoomer.html#a5">00231</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#a4">QwtPlotZoomer::setZoomBase</a>(<span class="keyword">const</span> QwtDoubleRect &amp;base)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233     <span class="keyword">const</span> <a class="code" href="class_qwt_plot.html">QwtPlot</a> *plt = <a class="code" href="class_qwt_plot_picker.html#a6">plot</a>();
<a name="l00234"></a>00234     <span class="keywordflow">if</span> ( !plt )
<a name="l00235"></a>00235         <span class="keywordflow">return</span>;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="keyword">const</span> QwtDoubleRect sRect = <a class="code" href="class_qwt_plot_picker.html#b0">scaleRect</a>();
<a name="l00238"></a>00238     <span class="keyword">const</span> QwtDoubleRect bRect = base | sRect;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     d_data-&gt;zoomStack.clear();
<a name="l00241"></a>00241     d_data-&gt;zoomStack.push(bRect);
<a name="l00242"></a>00242     d_data-&gt;zoomRectIndex = 0;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="keywordflow">if</span> ( base != sRect )
<a name="l00245"></a>00245     {
<a name="l00246"></a>00246         d_data-&gt;zoomStack.push(sRect);
<a name="l00247"></a>00247         d_data-&gt;zoomRectIndex++;
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <a class="code" href="class_qwt_plot_zoomer.html#b0">rescale</a>();
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00258"></a><a class="code" href="class_qwt_plot_zoomer.html#a7">00258</a> QwtDoubleRect <a class="code" href="class_qwt_plot_zoomer.html#a7">QwtPlotZoomer::zoomRect</a>()<span class="keyword"> const</span>
<a name="l00259"></a>00259 <span class="keyword"></span>{
<a name="l00260"></a>00260     <span class="keywordflow">return</span> d_data-&gt;zoomStack[d_data-&gt;zoomRectIndex];
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00266"></a><a class="code" href="class_qwt_plot_zoomer.html#a12">00266</a> uint <a class="code" href="class_qwt_plot_zoomer.html#a12">QwtPlotZoomer::zoomRectIndex</a>()<span class="keyword"> const</span>
<a name="l00267"></a>00267 <span class="keyword"></span>{
<a name="l00268"></a>00268     <span class="keywordflow">return</span> d_data-&gt;zoomRectIndex;
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00282"></a><a class="code" href="class_qwt_plot_zoomer.html#i2">00282</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#i2">QwtPlotZoomer::zoom</a>(<span class="keyword">const</span> QwtDoubleRect &amp;rect)
<a name="l00283"></a>00283 {   
<a name="l00284"></a>00284     <span class="keywordflow">if</span> ( d_data-&gt;maxStackDepth &gt;= 0 &amp;&amp; 
<a name="l00285"></a>00285         <span class="keywordtype">int</span>(d_data-&gt;zoomRectIndex) &gt;= d_data-&gt;maxStackDepth )
<a name="l00286"></a>00286     {
<a name="l00287"></a>00287         <span class="keywordflow">return</span>;
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <span class="keyword">const</span> QwtDoubleRect <a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a> = d_data-&gt;zoomStack[0] &amp; rect.normalized();
<a name="l00291"></a>00291     <span class="keywordflow">if</span> ( zoomRect != d_data-&gt;zoomStack[d_data-&gt;zoomRectIndex] )
<a name="l00292"></a>00292     {
<a name="l00293"></a>00293         <span class="keywordflow">for</span> ( uint i = <span class="keywordtype">int</span>(d_data-&gt;zoomStack.count()) - 1; 
<a name="l00294"></a>00294            i &gt; d_data-&gt;zoomRectIndex; i-- )
<a name="l00295"></a>00295         {
<a name="l00296"></a>00296             (void)d_data-&gt;zoomStack.pop();
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         d_data-&gt;zoomStack.push(zoomRect);
<a name="l00300"></a>00300         d_data-&gt;zoomRectIndex++;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <a class="code" href="class_qwt_plot_zoomer.html#b0">rescale</a>();
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         emit <a class="code" href="class_qwt_plot_zoomer.html#l0">zoomed</a>(zoomRect);
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00319"></a><a class="code" href="class_qwt_plot_zoomer.html#i3">00319</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#i2">QwtPlotZoomer::zoom</a>(<span class="keywordtype">int</span> offset)
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321     <span class="keywordflow">if</span> ( offset == 0 )
<a name="l00322"></a>00322         d_data-&gt;zoomRectIndex = 0;
<a name="l00323"></a>00323     <span class="keywordflow">else</span>
<a name="l00324"></a>00324     {
<a name="l00325"></a>00325         <span class="keywordtype">int</span> newIndex = d_data-&gt;zoomRectIndex + offset;
<a name="l00326"></a>00326         newIndex = <a class="code" href="qwt__math_8h.html#a0">qwtMax</a>(0, newIndex);
<a name="l00327"></a>00327         newIndex = <a class="code" href="qwt__math_8h.html#a1">qwtMin</a>(<span class="keywordtype">int</span>(d_data-&gt;zoomStack.count()) - 1, newIndex);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         d_data-&gt;zoomRectIndex = uint(newIndex);
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     <a class="code" href="class_qwt_plot_zoomer.html#b0">rescale</a>();
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     emit <a class="code" href="class_qwt_plot_zoomer.html#l0">zoomed</a>(<a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a>());
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00343"></a><a class="code" href="class_qwt_plot_zoomer.html#b0">00343</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#b0">QwtPlotZoomer::rescale</a>()
<a name="l00344"></a>00344 {
<a name="l00345"></a>00345     <a class="code" href="class_qwt_plot.html">QwtPlot</a> *plt = <a class="code" href="class_qwt_plot_picker.html#a6">plot</a>();
<a name="l00346"></a>00346     <span class="keywordflow">if</span> ( !plt )
<a name="l00347"></a>00347         <span class="keywordflow">return</span>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="keyword">const</span> QwtDoubleRect &amp;rect = d_data-&gt;zoomStack[d_data-&gt;zoomRectIndex];
<a name="l00350"></a>00350     <span class="keywordflow">if</span> ( rect != <a class="code" href="class_qwt_plot_picker.html#b0">scaleRect</a>() )
<a name="l00351"></a>00351     {
<a name="l00352"></a>00352         <span class="keyword">const</span> <span class="keywordtype">bool</span> doReplot = plt-&gt;<a class="code" href="class_qwt_plot.html#a6">autoReplot</a>();
<a name="l00353"></a>00353         plt-&gt;<a class="code" href="class_qwt_plot.html#a5">setAutoReplot</a>(<span class="keyword">false</span>);
<a name="l00354"></a>00354 
<a name="l00355"></a>00355         <span class="keywordtype">double</span> x1 = rect.left();
<a name="l00356"></a>00356         <span class="keywordtype">double</span> x2 = rect.right();
<a name="l00357"></a>00357         <span class="keywordflow">if</span> ( plt-&gt;<a class="code" href="class_qwt_plot.html#a39">axisScaleDiv</a>(<a class="code" href="class_qwt_plot_picker.html#a4">xAxis</a>())-&gt;<a class="code" href="class_qwt_scale_div.html#a5">lBound</a>() &gt; 
<a name="l00358"></a>00358             plt-&gt;<a class="code" href="class_qwt_plot.html#a39">axisScaleDiv</a>(<a class="code" href="class_qwt_plot_picker.html#a4">xAxis</a>())-&gt;<a class="code" href="class_qwt_scale_div.html#a6">hBound</a>() )
<a name="l00359"></a>00359         {
<a name="l00360"></a>00360             qSwap(x1, x2);
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         plt-&gt;<a class="code" href="class_qwt_plot.html#a36">setAxisScale</a>(<a class="code" href="class_qwt_plot_picker.html#a4">xAxis</a>(), x1, x2);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <span class="keywordtype">double</span> y1 = rect.top();
<a name="l00366"></a>00366         <span class="keywordtype">double</span> y2 = rect.bottom();
<a name="l00367"></a>00367         <span class="keywordflow">if</span> ( plt-&gt;<a class="code" href="class_qwt_plot.html#a39">axisScaleDiv</a>(<a class="code" href="class_qwt_plot_picker.html#a5">yAxis</a>())-&gt;<a class="code" href="class_qwt_scale_div.html#a5">lBound</a>() &gt; 
<a name="l00368"></a>00368             plt-&gt;<a class="code" href="class_qwt_plot.html#a39">axisScaleDiv</a>(<a class="code" href="class_qwt_plot_picker.html#a5">yAxis</a>())-&gt;<a class="code" href="class_qwt_scale_div.html#a6">hBound</a>() )
<a name="l00369"></a>00369         {
<a name="l00370"></a>00370             qSwap(y1, y2);
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372         plt-&gt;<a class="code" href="class_qwt_plot.html#a36">setAxisScale</a>(<a class="code" href="class_qwt_plot_picker.html#a5">yAxis</a>(), y1, y2);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         plt-&gt;<a class="code" href="class_qwt_plot.html#a5">setAutoReplot</a>(doReplot);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         plt-&gt;<a class="code" href="class_qwt_plot.html#i1">replot</a>();
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00387"></a><a class="code" href="class_qwt_plot_zoomer.html#a8">00387</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#a8">QwtPlotZoomer::setAxis</a>(<span class="keywordtype">int</span> xAxis, <span class="keywordtype">int</span> yAxis)
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389     <span class="keywordflow">if</span> ( xAxis != <a class="code" href="class_qwt_plot_picker.html#a4">QwtPlotPicker::xAxis</a>() || yAxis != <a class="code" href="class_qwt_plot_picker.html#a5">QwtPlotPicker::yAxis</a>() )
<a name="l00390"></a>00390     {
<a name="l00391"></a>00391         <a class="code" href="class_qwt_plot_picker.html#a3">QwtPlotPicker::setAxis</a>(xAxis, yAxis);
<a name="l00392"></a>00392         <a class="code" href="class_qwt_plot_zoomer.html#a4">setZoomBase</a>(<a class="code" href="class_qwt_plot_picker.html#b0">scaleRect</a>());
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00406"></a><a class="code" href="class_qwt_plot_zoomer.html#b2">00406</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#b2">QwtPlotZoomer::widgetMouseReleaseEvent</a>(QMouseEvent *me)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408     <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_event_pattern.html#a12">mouseMatch</a>(MouseSelect2, me) )
<a name="l00409"></a>00409         <a class="code" href="class_qwt_plot_zoomer.html#i2">zoom</a>(0);
<a name="l00410"></a>00410     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_event_pattern.html#a12">mouseMatch</a>(MouseSelect3, me) )
<a name="l00411"></a>00411         <a class="code" href="class_qwt_plot_zoomer.html#i2">zoom</a>(-1);
<a name="l00412"></a>00412     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_event_pattern.html#a12">mouseMatch</a>(MouseSelect6, me) )
<a name="l00413"></a>00413         <a class="code" href="class_qwt_plot_zoomer.html#i2">zoom</a>(+1);
<a name="l00414"></a>00414     <span class="keywordflow">else</span> 
<a name="l00415"></a>00415         <a class="code" href="class_qwt_picker.html#b7">QwtPlotPicker::widgetMouseReleaseEvent</a>(me);
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00429"></a><a class="code" href="class_qwt_plot_zoomer.html#b3">00429</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#b3">QwtPlotZoomer::widgetKeyPressEvent</a>(QKeyEvent *ke)
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431     <span class="keywordflow">if</span> ( !<a class="code" href="class_qwt_picker.html#a19">isActive</a>() )
<a name="l00432"></a>00432     {
<a name="l00433"></a>00433         <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_event_pattern.html#a13">keyMatch</a>(KeyUndo, ke) )
<a name="l00434"></a>00434             <a class="code" href="class_qwt_plot_zoomer.html#i2">zoom</a>(-1);
<a name="l00435"></a>00435         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_event_pattern.html#a13">keyMatch</a>(KeyRedo, ke) )
<a name="l00436"></a>00436             <a class="code" href="class_qwt_plot_zoomer.html#i2">zoom</a>(+1);
<a name="l00437"></a>00437         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_qwt_event_pattern.html#a13">keyMatch</a>(KeyHome, ke) )
<a name="l00438"></a>00438             <a class="code" href="class_qwt_plot_zoomer.html#i2">zoom</a>(0);
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <a class="code" href="class_qwt_picker.html#b11">QwtPlotPicker::widgetKeyPressEvent</a>(ke);
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00452"></a><a class="code" href="class_qwt_plot_zoomer.html#i0">00452</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#i0">QwtPlotZoomer::moveBy</a>(<span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <span class="keyword">const</span> QwtDoubleRect &amp;rect = d_data-&gt;zoomStack[d_data-&gt;zoomRectIndex];
<a name="l00455"></a>00455     <a class="code" href="class_qwt_plot_zoomer.html#i1">move</a>(rect.left() + dx, rect.top() + dy);
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00467"></a><a class="code" href="class_qwt_plot_zoomer.html#i1">00467</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#i1">QwtPlotZoomer::move</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469     <span class="keywordflow">if</span> ( x &lt; <a class="code" href="class_qwt_plot_zoomer.html#a6">zoomBase</a>().left() )
<a name="l00470"></a>00470         x = <a class="code" href="class_qwt_plot_zoomer.html#a6">zoomBase</a>().left();
<a name="l00471"></a>00471     <span class="keywordflow">if</span> ( x &gt; <a class="code" href="class_qwt_plot_zoomer.html#a6">zoomBase</a>().right() - <a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a>().width() )
<a name="l00472"></a>00472         x = <a class="code" href="class_qwt_plot_zoomer.html#a6">zoomBase</a>().right() - <a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a>().width();
<a name="l00473"></a>00473 
<a name="l00474"></a>00474     <span class="keywordflow">if</span> ( y &lt; <a class="code" href="class_qwt_plot_zoomer.html#a6">zoomBase</a>().top() )
<a name="l00475"></a>00475         y = <a class="code" href="class_qwt_plot_zoomer.html#a6">zoomBase</a>().top();
<a name="l00476"></a>00476     <span class="keywordflow">if</span> ( y &gt; <a class="code" href="class_qwt_plot_zoomer.html#a6">zoomBase</a>().bottom() - <a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a>().height() )
<a name="l00477"></a>00477         y = <a class="code" href="class_qwt_plot_zoomer.html#a6">zoomBase</a>().bottom() - <a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a>().height();
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="keywordflow">if</span> ( x != <a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a>().left() || y != <a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a>().top() )
<a name="l00480"></a>00480     {
<a name="l00481"></a>00481         d_data-&gt;zoomStack[d_data-&gt;zoomRectIndex].moveTo(x, y);
<a name="l00482"></a>00482         <a class="code" href="class_qwt_plot_zoomer.html#b0">rescale</a>();
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 
<a name="l00497"></a><a class="code" href="class_qwt_plot_zoomer.html#b6">00497</a> <span class="keywordtype">bool</span> <a class="code" href="class_qwt_plot_zoomer.html#b6">QwtPlotZoomer::accept</a>(QwtPolygon &amp;pa)<span class="keyword"> const</span>
<a name="l00498"></a>00498 <span class="keyword"></span>{
<a name="l00499"></a>00499     <span class="keywordflow">if</span> ( pa.count() &lt; 2 )
<a name="l00500"></a>00500         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     QRect rect = QRect(pa[0], pa[<span class="keywordtype">int</span>(pa.count()) - 1]);
<a name="l00503"></a>00503 <span class="preprocessor">#if QT_VERSION &lt; 0x040000</span>
<a name="l00504"></a>00504 <span class="preprocessor"></span>    rect = rect.normalize();
<a name="l00505"></a>00505 <span class="preprocessor">#else</span>
<a name="l00506"></a>00506 <span class="preprocessor"></span>    rect = rect.normalized();
<a name="l00507"></a>00507 <span class="preprocessor">#endif</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span>
<a name="l00509"></a>00509     <span class="keyword">const</span> <span class="keywordtype">int</span> minSize = 2;
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (rect.width() &lt; minSize &amp;&amp; rect.height() &lt; minSize )
<a name="l00511"></a>00511         <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="class_qwt_plot_zoomer.html#b1">minZoomSize</a> = 11;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="keyword">const</span> QPoint center = rect.center();
<a name="l00516"></a>00516     rect.setSize(rect.size().expandedTo(QSize(minZoomSize, minZoomSize)));
<a name="l00517"></a>00517     rect.moveCenter(center);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     pa.resize(2);
<a name="l00520"></a>00520     pa[0] = rect.topLeft();
<a name="l00521"></a>00521     pa[1] = rect.bottomRight();
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 
<a name="l00531"></a><a class="code" href="class_qwt_plot_zoomer.html#b1">00531</a> QwtDoubleSize <a class="code" href="class_qwt_plot_zoomer.html#b1">QwtPlotZoomer::minZoomSize</a>()<span class="keyword"> const</span>
<a name="l00532"></a>00532 <span class="keyword"></span>{
<a name="l00533"></a>00533     <span class="keywordflow">return</span> QwtDoubleSize(
<a name="l00534"></a>00534         d_data-&gt;zoomStack[0].width() / 10e4,
<a name="l00535"></a>00535         d_data-&gt;zoomStack[0].height() / 10e4
<a name="l00536"></a>00536     );
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 
<a name="l00545"></a><a class="code" href="class_qwt_plot_zoomer.html#b4">00545</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#b4">QwtPlotZoomer::begin</a>()
<a name="l00546"></a>00546 {
<a name="l00547"></a>00547     <span class="keywordflow">if</span> ( d_data-&gt;maxStackDepth &gt;= 0 )
<a name="l00548"></a>00548     {
<a name="l00549"></a>00549         <span class="keywordflow">if</span> ( d_data-&gt;zoomRectIndex &gt;= uint(d_data-&gt;maxStackDepth) )
<a name="l00550"></a>00550             <span class="keywordflow">return</span>;
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     <span class="keyword">const</span> QwtDoubleSize minSize = <a class="code" href="class_qwt_plot_zoomer.html#b1">minZoomSize</a>();
<a name="l00554"></a>00554     <span class="keywordflow">if</span> ( minSize.isValid() )
<a name="l00555"></a>00555     {
<a name="l00556"></a>00556         <span class="keyword">const</span> QwtDoubleSize sz = 
<a name="l00557"></a>00557             d_data-&gt;zoomStack[d_data-&gt;zoomRectIndex].size() * 0.9999;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559         <span class="keywordflow">if</span> ( minSize.width() &gt;= sz.width() &amp;&amp;
<a name="l00560"></a>00560             minSize.height() &gt;= sz.height() )
<a name="l00561"></a>00561         {
<a name="l00562"></a>00562             <span class="keywordflow">return</span>;
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <a class="code" href="class_qwt_picker.html#b2">QwtPlotPicker::begin</a>();
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00575"></a><a class="code" href="class_qwt_plot_zoomer.html#b5">00575</a> <span class="keywordtype">bool</span> <a class="code" href="class_qwt_plot_zoomer.html#b5">QwtPlotZoomer::end</a>(<span class="keywordtype">bool</span> ok)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     ok = <a class="code" href="class_qwt_plot_picker.html#b9">QwtPlotPicker::end</a>(ok);
<a name="l00578"></a>00578     <span class="keywordflow">if</span> (!ok)
<a name="l00579"></a>00579         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <a class="code" href="class_qwt_plot.html">QwtPlot</a> *<a class="code" href="class_qwt_plot_picker.html#a6">plot</a> = <a class="code" href="class_qwt_plot_picker.html#a6">QwtPlotZoomer::plot</a>();
<a name="l00582"></a>00582     <span class="keywordflow">if</span> ( !plot )
<a name="l00583"></a>00583         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="keyword">const</span> QwtPolygon &amp;pa = <a class="code" href="class_qwt_picker.html#a24">selection</a>();
<a name="l00586"></a>00586     <span class="keywordflow">if</span> ( pa.count() &lt; 2 )
<a name="l00587"></a>00587         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     QRect rect = QRect(pa[0], pa[<span class="keywordtype">int</span>(pa.count() - 1)]);
<a name="l00590"></a>00590 <span class="preprocessor">#if QT_VERSION &lt; 0x040000</span>
<a name="l00591"></a>00591 <span class="preprocessor"></span>    rect = rect.normalize();
<a name="l00592"></a>00592 <span class="preprocessor">#else</span>
<a name="l00593"></a>00593 <span class="preprocessor"></span>    rect = rect.normalized();
<a name="l00594"></a>00594 <span class="preprocessor">#endif</span>
<a name="l00595"></a>00595 <span class="preprocessor"></span>
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     QwtDoubleRect <a class="code" href="class_qwt_plot_zoomer.html#a7">zoomRect</a> = <a class="code" href="class_qwt_plot_picker.html#b1">invTransform</a>(rect).normalized();
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="keyword">const</span> QwtDoublePoint center = zoomRect.center();
<a name="l00600"></a>00600     zoomRect.setSize(zoomRect.size().expandedTo(<a class="code" href="class_qwt_plot_zoomer.html#b1">minZoomSize</a>()));
<a name="l00601"></a>00601     zoomRect.moveCenter(center);
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     <a class="code" href="class_qwt_plot_zoomer.html#i2">zoom</a>(zoomRect);
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00619"></a><a class="code" href="class_qwt_plot_zoomer.html#a13">00619</a> <span class="keywordtype">void</span> <a class="code" href="class_qwt_plot_zoomer.html#a13">QwtPlotZoomer::setSelectionFlags</a>(<span class="keywordtype">int</span> flags)
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621     <span class="comment">// we accept only rects</span>
<a name="l00622"></a>00622     flags &amp;= ~(PointSelection | PolygonSelection);
<a name="l00623"></a>00623     flags |= RectSelection;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <a class="code" href="class_qwt_picker.html#a3">QwtPlotPicker::setSelectionFlags</a>(flags);
<a name="l00626"></a>00626 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Sep 17 18:36:55 2006 for Qwt User's Guide by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
